# LoRA Pipeline - Functional Requirements
**Version:** 2.0.0  
**Date:** 12/16/2025  
**Category:** Design System Platform
**Product Abbreviation:** pipeline

**Source References:**
- Seed Story: `pmc\product\00-pipeline-seed-story.md`
- Overview Document: `pmc\product\01-pipeline-overview.md`
- User Stories: `pmc\product\02-pipeline-user-stories.md`


## 7. Cost Management & Budget Control

- **FR7.1.1:** Live Cost Accumulation Display
  * Description: System shall implement real-time cost tracking displaying current spend, hourly rates, elapsed time, cost estimate comparisons, and projected final costs through prominent dashboard card with automatic 60-second updates, calculating costs as elapsed GPU hours multiplied by pricing tier rates plus spot interruption overhead, providing visual indicators (green <80%, yellow 80-100%, red >100%), triggering threshold-based warnings (80%, 100%, 120%), offering immediate cancellation access, and showing itemized cost breakdowns (GPU compute, interruption overhead, storage) to enable continuous cost monitoring, budget awareness, proactive intervention, and informed continuation decisions during active training.
  * Impact Weighting: Cost Control / Budget Awareness / User Empowerment
  * Priority: High
  * User Stories: US7.1.1
  * User Journey: UJ7.1.1 (Live Cost Monitoring), UJ7.1.2 (Cost-Based Decisions)
  * Tasks: [T-7.1.1]
  * User Story Acceptance Criteria:
    - **Cost Tracker Card** on job dashboard (prominent, top-right):
    - Estimated cost: $45-55
    - Current spend: $22.18 (49% of estimate)
    - Hourly rate: $2.49/hr (spot)
    - Elapsed time: 6h 23m
    - Projected final cost: $47.32 (within estimate)
    - **Update frequency**: Every 60 seconds (real-time polling or websocket)
    - **Cost calculation**: (elapsed_time_hours √ó gpu_hourly_rate) + spot_interruption_overhead
    - **Visual indicators**:
    - Green: Current spend <80% of estimate
    - Yellow: Current spend 80-100% of estimate
    - Red: Current spend >100% of estimate (over budget)
    - **Warning alerts**:
    - At 80% of estimate: "Job approaching cost estimate ($36 of $45). Monitor closely."
    - At 100% of estimate: "Job exceeded cost estimate ($46 of $45). Consider cancelling."
    - At 120% of estimate: "Job significantly over budget ($54 of $45). Review immediately."
    - **Cancel option**: "Cancel Job" button readily accessible if cost is concerning
    - **Cost breakdown**:
    - GPU compute: $21.00 (8.4 hrs @ $2.49/hr)
    - Spot interruption overhead: $1.18 (2 interruptions)
    - Storage (checkpoints): $0.00 (included)
    - Total: $22.18
  * Functional Requirements Acceptance Criteria:
    - **Cost Tracker Card Placement**: Positioned prominently on job dashboard, top-right quadrant above metrics display, visible without scrolling (above fold), card size: 350px √ó 280px (responsive), sticky positioning: Remains visible during scroll on desktop
    - **Card Header**: "Cost Tracking" title with üí∞ icon, Last updated timestamp: "Updated 23 seconds ago" (relative time), Refresh indicator: Small spinner when fetching updates
    - **Primary Cost Display**: **Current Spend**: Large, bold: "$22.18", Progress indicator: "49% of estimate" (circular progress ring or bar), Visual color based on threshold: Green (<80%), Yellow (80-100%), Red (>100%); **Estimated Cost Range**: "Estimated: $45-55" (smaller text, gray), Comparison indicator: "‚Üì $2.82 below estimate" (if under) or "‚Üë $4.18 over estimate" (if over); **Hourly Rate**: "Rate: $2.49/hr (spot)" with GPU type indicator (Spot/On-Demand badge), Comparison to on-demand: "vs $7.99/hr on-demand (saving $5.50/hr)"
    - **Elapsed Time Display**: "Elapsed: 6h 23m" with timer icon, Live countdown timer (client-side, updates every second), Breakdown: "Active: 6h 15m, Paused: 8m" (if applicable)
    - **Projected Final Cost**: "Projected: $47.32" (calculated based on remaining steps and current rate), Variance indicator: "¬±15% confidence" (based on historical accuracy), Completion estimate: "Est. final in 8h 15m ‚Üí Total: $47.32"
    - **Cost Calculation Engine**: Active GPU time: elapsed_hours = (NOW() - job_started_at - total_paused_minutes) / 60, GPU compute cost = elapsed_hours √ó gpu_hourly_rate (spot: $2.49/hr, on-demand: $7.99/hr for H100); Spot interruption overhead: Per interruption: recovery_time_minutes = resumed_at - interrupted_at (typically 5-10 min), overhead_cost = (SUM(recovery_time_minutes) / 60) √ó spot_hourly_rate, Total interruption cost = overhead_cost √ó interruption_count; Storage costs: Checkpoint storage: $0.00 (included in base pricing, negligible), Artifact storage: $0.00 (first 100GB free); Total Current Cost = gpu_compute_cost + interruption_overhead_cost + storage_cost; Store: UPDATE training_jobs SET current_cost = 22.18, cost_updated_at = NOW()
    - **Update Frequency**: Automatic updates every 60 seconds via polling: Frontend polls GET /api/training-jobs/{id}/cost-metrics every 60s, Backend calculates current cost and returns JSON, Frontend updates display without full page reload; Or WebSocket (preferred for real-time): Server pushes cost updates to connected clients when cost changes significantly (>$0.50 delta), Reduces server load, provides instant updates; Loading state: Skeleton/shimmer effect while fetching, Never blocks user interaction
    - **Visual Threshold Indicators**: **Green Zone (<80% of estimate)**: Card border: Green (2px), Progress ring/bar: Green fill, Icon: ‚úì checkmark, Message: "On track" or "Within budget"; **Yellow Zone (80-100% of estimate)**: Card border: Yellow/orange (2px), Progress ring/bar: Yellow fill, Icon: ‚ö†Ô∏è warning triangle, Message: "Approaching estimate", Alert banner (dismissable): "Job at 87% of estimated cost. Monitor closely."; **Red Zone (>100% of estimate)**: Card border: Red (3px, thicker), Progress ring/bar: Red fill, Icon: ‚ö†Ô∏è or üö®, Message: "Over budget", Alert banner (persistent, not dismissable): "Job exceeded estimate by $4.18. Consider cancelling or adjusting."
    - **Threshold Warning Alerts**: **80% Threshold Alert**: Triggered when current_cost >= (estimated_cost_min √ó 0.8), In-app notification banner: "Job approaching cost estimate ($36 of $45). Monitor closely.", Email notification (if user opted-in): Subject: "Training Cost Alert: 80% of estimate", Body: Job name, current cost, estimated cost, link to dashboard, Slack notification (if configured); **100% Threshold Alert**: Triggered when current_cost >= estimated_cost_max, Banner: "Job exceeded cost estimate ($46 of $45). Consider cancelling if necessary.", Email: Subject: "[Action Required] Training Cost Exceeded Estimate", Slack: Urgent channel post with @mention; **120% Threshold Alert**: Triggered when current_cost >= (estimated_cost_max √ó 1.2), Banner: "Job significantly over budget ($54 of $45). Review immediately.", Email: High priority flag, Slack: @channel mention in critical alerts channel, Push notification (mobile)
    - **Immediate Cancellation Access**: "Cancel Job" button prominently displayed within Cost Tracker Card, Positioned below cost details, always visible, Button styling: Destructive appearance (red outline), disabled appearance if job not active, Click opens quick cancellation modal: "Cancel Training?", Simplified modal: Job name, current cost, "Cancel" and "Continue Training" buttons, No extensive form (quick action for cost concerns), Confirmation: Immediate job termination, final cost locked at current amount
    - **Cost Breakdown Expandable Section**: "View Cost Breakdown" link/button expands detailed itemization, **GPU Compute Cost**: Hours breakdown: "Active training: 6h 15m @ $2.49/hr = $15.57", Model loading: "15 min @ $2.49/hr = $0.62", Preprocessing: "5 min @ $2.49/hr = $0.21", Total GPU: "$16.40"; **Spot Interruption Overhead**: List each interruption: "Interruption #1: 8 min recovery @ $2.49/hr = $0.33", "Interruption #2: 10 min recovery @ $2.49/hr = $0.42", Total interruptions: "$0.75"; **Storage Costs**: Checkpoints: "4.2GB stored = $0.00 (included)", Training artifacts: "0.5GB = $0.00 (included)", Total storage: "$0.00"; **Grand Total**: "$17.15" (sum of all components), Matches "Current Spend" display
    - **Cost Comparison to On-Demand**: "Savings vs On-Demand" section shows: If using spot: "On-demand equivalent: $52.82 (6.25hrs @ $7.99/hr)", "Your savings: $30.64 (58% cheaper)", green highlight; If using on-demand: "Cost with spot: $16.40 (estimated)", "Premium paid: $36.42 for guaranteed completion", no savings, but reliability benefit noted
    - **Historical Cost Tracking**: Store cost snapshots every 5 minutes: INSERT cost_history (job_id, timestamp, current_cost, elapsed_hours, gpu_rate), Use for projection accuracy, Display mini line chart in cost card: X-axis: Time, Y-axis: Cost, Shows cost accumulation curve (should be roughly linear), Helps identify anomalies (sudden cost spike = issue)
    - **Mobile Responsive Design**: Desktop (>768px): Full card with all details visible; Tablet (768-1023px): Slightly condensed, breakdown collapsed by default; Mobile (<768px): Simplified view: Current cost (large), estimate comparison, elapsed time, "View Details" expands full breakdown, Cancel button prominent
    - **Accessibility**: Cost amounts announced to screen readers: "Current cost: $22.18, which is 49% of estimated cost", Visual indicators supplemented with text labels (not color-only), Keyboard navigation: Tab through card elements, Enter to expand breakdown, Screen reader updates when cost changes significantly (>$5 delta), High contrast mode support
    - **Performance Optimization**: Cost calculation performed server-side (not client-side to avoid drift), Cached for 60 seconds (no need for more frequent recalc), Optimized database queries: SELECT started_at, paused_minutes, interruption_count, gpu_pricing_tier FROM training_jobs WHERE id = {id}, Minimal payload: Only essential data sent to frontend (not full job object)

- **FR7.1.2:** Cost vs Time Remaining Projection
  * Description: System shall implement intelligent cost and time projection using historical step completion rates, calculating average time per step from completed work, estimating remaining duration by multiplying remaining steps by average step time, projecting final costs by adding current spend to estimated remaining costs, displaying projections with confidence intervals based on variance, providing scenario analysis (best/expected/worst case), offering decision support recommendations when projections exceed thresholds, tracking projection accuracy against actual outcomes, and continuously improving projection algorithms using historical data to enable proactive budget management and informed continuation or cancellation decisions.
  * Impact Weighting: Budget Planning / Informed Decision-Making / Cost Control
  * Priority: Medium
  * User Stories: US7.1.2
  * User Journey: UJ7.2.1 (Cost Projections), UJ7.2.2 (Completion Forecasting)
  * Tasks: [T-7.1.2]
  * User Story Acceptance Criteria:
    - **Projection Algorithm**:
    - Calculate average time per step based on completed steps
    - Estimate remaining time: (remaining_steps √ó avg_time_per_step)
    - Project final cost: current_cost + (remaining_time √ó hourly_rate)
    - **Projection Display**:
    - "At current rate, job will complete in 8.2 hours"
    - "Projected final cost: $47.32 (¬±15% variance)"
    - "Expected completion: Today at 11:45 PM"
    - **Scenario Analysis**:
    - Best case: Training accelerates in later epochs (GPU optimization)
    - Expected case: Current rate continues
    - Worst case: Training slows down (loss plateau, more validation runs)
    - **Decision Support**:
    - If projected cost >120% of estimate: "Consider cancelling and retrying with more efficient configuration"
    - If projected cost within estimate: "On track, continue monitoring"
    - **Historical Accuracy**:
    - Track actual vs projected cost for completed jobs
    - Display accuracy metric: "Projections typically ¬±12% accurate"
    - Improve projection algorithm over time based on historical data
  * Functional Requirements Acceptance Criteria:
    - **Projection Algorithm - Time Remaining**: Query current training progress: current_step, total_steps, training_started_at, current_epoch, total_epochs; Calculate completed steps: steps_completed = current_step, steps_remaining = total_steps - current_step; Calculate average time per step: training_elapsed_seconds = (NOW() - training_started_at) - paused_time - interruption_downtime, avg_seconds_per_step = training_elapsed_seconds / steps_completed (only if steps_completed > 50 for statistical validity); Estimate remaining time: remaining_seconds = steps_remaining √ó avg_seconds_per_step, remaining_hours = remaining_seconds / 3600; Adjust for finalization overhead: Add 15 minutes for model saving, artifacts upload, validation (if enabled +20 min), total_remaining_hours = remaining_hours + overhead_hours; Format display: "8.2 hours" (1 decimal), "8h 15m" (if <24 hours), "1d 3h" (if >24 hours)
    - **Projection Algorithm - Final Cost**: Current cost: current_spend = (current calculation from FR7.1.1); Remaining cost estimation: remaining_gpu_cost = remaining_hours √ó gpu_hourly_rate, Add buffer for potential spot interruptions (if spot): interruption_buffer = remaining_hours √ó 0.05 √ó gpu_hourly_rate (assume 5% overhead), remaining_cost = remaining_gpu_cost + interruption_buffer; Projected final cost: projected_final = current_spend + remaining_cost; Confidence interval calculation: historical_variance = StdDev(actual_cost / projected_cost for similar completed jobs), confidence_interval = ¬±(historical_variance √ó projected_final), typical confidence: ¬±12-18%; Display: "Projected final cost: $47.32 (¬±15% variance)" or "Projected: $40-54"
    - **Expected Completion Time**: Calculate: completion_timestamp = NOW() + remaining_seconds; Format based on proximity: If <12 hours: "Today at 11:45 PM", If 12-36 hours: "Tomorrow at 2:15 PM", If >36 hours: "Thursday, Dec 19 at 9:30 AM", Timezone: User's local timezone with label: "PST"; Include relative time: "in 8 hours 15 minutes"; Update every 60 seconds (same cadence as cost updates)
    - **Scenario Analysis Display**: Card section: "Projection Scenarios", Three scenarios with probability indicators: **Best Case** (20% probability): Assumptions: Training accelerates in later epochs (common pattern), Fewer validation runs than expected, No spot interruptions (if spot) or 1 interruption max, Time: "7.1 hours" (13% faster), Cost: "$42.50" (10% cheaper), Completion: "Today at 10:30 PM"; **Expected Case** (60% probability): Assumptions: Current rate continues, Typical spot interruption rate (if spot: 1-2 interruptions), Standard validation frequency, Time: "8.2 hours" (baseline), Cost: "$47.32" (baseline), Completion: "Today at 11:45 PM"; **Worst Case** (20% probability): Assumptions: Training slows down (loss plateau, more gradient calc), Higher spot interruption rate (if spot: 3-4 interruptions), Additional validation runs if quality concerns, Time: "9.8 hours" (20% slower), Cost: "$55.20" (17% more expensive), Completion: "Tomorrow at 1:15 AM"; Visual representation: Horizontal bar chart showing range from best to worst, marker indicating expected case
    - **Decision Support Recommendations**: Algorithm evaluates projected cost against original estimate: IF projected_final > (estimated_max √ó 1.2): status = 'significantly_over', message = "‚ö†Ô∏è Projected cost ($55) significantly exceeds estimate ($45-55). Consider: Cancelling this job and retrying with more efficient configuration (Conservative preset, smaller batch size), Switching to on-demand GPU if cost overrun due to spot interruptions, Accepting higher cost if job critical and near completion (>70% done)", action_buttons = ["Cancel Job", "Continue Anyway", "View Cost History"]; ELSIF projected_final > estimated_max: status = 'slightly_over', message = "‚ö† Projected cost ($52) slightly over estimate ($45-55, +$2). Monitor closely. Acceptable variance given training uncertainty.", action_buttons = ["Continue Monitoring"]; ELSE: status = 'on_track', message = "‚úì On track. Projected cost ($47) within estimate range ($45-55).", action_buttons = none; Display recommendation prominently below projection display
    - **Historical Accuracy Tracking**: For each completed job: Calculate projection_accuracy = (actual_final_cost / projected_final_cost_at_50%_complete) √ó 100, Store: INSERT projection_accuracy_history (job_id, projected_cost, actual_cost, accuracy_pct, preset, gpu_type, dataset_size, timestamp); Aggregate accuracy metrics: Overall accuracy: AVG(ABS(100 - accuracy_pct)) across all completed jobs (typical: ¬±10-15%), Per-preset accuracy: Conservative: ¬±8% (more predictable), Balanced: ¬±12%, Aggressive: ¬±18% (higher variance), Per-GPU type: Spot: ¬±15% (interruption variability), On-demand: ¬±9% (more predictable); Display on projection card: "Projections typically ¬±12% accurate based on 47 completed jobs"
    - **Continuous Projection Improvement**: Machine learning approach (future enhancement): Train regression model on: Features: steps_completed, avg_seconds_per_step, current_loss, dataset_size, preset, gpu_type, interruption_count, time_of_day, datacenter_load, Target: actual_final_cost, Use model predictions instead of simple linear extrapolation; Pattern recognition: Identify common acceleration/deceleration patterns: "Jobs typically slow down in final 10% (validation overhead)", "Conservative preset accelerates after epoch 1 (GPU warming)", "Spot jobs with 0 interruptions by 50% complete unlikely to interrupt later (87% confidence)", Adjust projections based on identified patterns; A/B testing projections: Show different projection algorithms to different users, Track which algorithm most accurate, Roll out winning algorithm to all users
    - **Visual Projection Timeline**: Horizontal timeline showing: Past (gray): Elapsed time with milestones (epochs completed), Present (marker): Current position, Future (blue): Projected remaining time with expected completion, Confidence band (light blue shading): Shows ¬±15% variance range; Interactive: Hover shows details at each point, Click epoch markers to see per-epoch cost breakdown, Zoom to focus on specific time range
    - **Cost Trajectory Chart**: Line graph showing: X-axis: Time (hours into training), Y-axis: Cost ($), Historical line (solid): Actual cost accumulation so far, Projected line (dashed): Expected cost trajectory, Confidence band (shaded): ¬±15% variance, Original estimate line (horizontal dashed): Shows estimate range ($45-55), Alert zones: Red shading if projection exceeds estimate; Chart updates every 60 seconds with new datapoint, Smooth animation (not jarring jumps)
    - **Projection Sensitivity Analysis**: Show how projections change with different assumptions: "If training accelerates by 10%: $43 final cost (‚Üì $4)", "If one more spot interruption: $49 final cost (‚Üë $2)", "If validation takes 30 min longer: $51 final cost (‚Üë $4)", Helps users understand projection volatility, Builds confidence in expected case being realistic
    - **Export Projection Data**: "Export Projections" button downloads CSV: Columns: timestamp, current_cost, projected_final_cost, remaining_hours, expected_completion, best_case, expected_case, worst_case, confidence_interval, Use case: Finance team wants projection data for budget forecasts, Managers need cost projections for client billing estimates
    - **Integration with Budget Alerts**: If projected_final exceeds monthly_remaining_budget: Trigger warning: "‚ö†Ô∏è This job's projected cost ($47) will exceed your remaining monthly budget ($35). Options: Increase monthly budget, Cancel this job, Cancel lower-priority active jobs"; Proactive budget management prevents surprise overages
    - **Projection Explanations**: "Why this projection?" expandable section: Explains calculation methodology in simple terms: "We calculate your average training speed (127 steps/hour) based on completed work, multiply remaining steps (1,150) by this rate (9.1 hours), and apply your GPU cost ($2.49/hr for spot H100) to estimate final cost ($47).", Shows historical accuracy to build trust: "Our projections have been ¬±12% accurate on your last 8 completed jobs.", Links to documentation: "Learn more about how we calculate projections"

- **FR7.2.1:** Monthly Budget Dashboard
  * Description: System shall implement comprehensive monthly budget dashboard at `/dashboard/training-budget` displaying summary cards (monthly spending, remaining budget, job counts, averages), daily spending accumulation trend graph with budget limit line, projected spending forecast with alert zones, per-job breakdown table sortable by cost, budget versus forecast analysis with overage warnings, customizable budget controls (limit amounts, period types, alert thresholds, job blocking toggles), historical comparison charts showing 6-month trends, and drill-down capabilities to enable financial planning, budget compliance monitoring, operational oversight, and proactive budget management for teams and individuals.
  * Impact Weighting: Financial Planning / Budget Compliance / Operational Oversight
  * Priority: High
  * User Stories: US7.2.1
  * User Journey: UJ7.3.1 (Budget Dashboard Overview), UJ7.3.2 (Budget Management)
  * Tasks: [T-7.2.1]
  * User Story Acceptance Criteria:
    - **Budget Dashboard** page at `/dashboard/training-budget`
    - **Summary Cards** (top of page):
    - **Monthly Spending**: $487.32 / $500.00 (97% used)
    - **Remaining Budget**: $12.68
    - **Jobs This Month**: 12 (10 completed, 2 active)
    - **Average Cost per Job**: $40.61
    - **Spending Trend Graph**:
    - Line chart: Daily spending accumulation over current month
    - Budget limit line: Horizontal line at $500
    - Projected spending: Dotted line showing forecast
    - Alert zone: Red shading when approaching/exceeding limit
    - **Per-Job Breakdown Table**:
    - Job Name, Status, Cost, Percentage of Budget, Date
    - Sort by cost (highest first)
    - Identify expensive jobs: "Job XYZ: $87 (17% of monthly budget)"
    - **Budget vs Forecast**:
    - Current spend: $487.32
    - Active jobs (in progress): $42-58 (2 jobs)
    - Forecasted month-end spend: $529-545
    - Warning: "Projected to exceed budget by $29-45"
    - **Budget Controls**:
    - Set monthly budget limit: $500 (default), customizable
    - Budget period: Calendar month or rolling 30 days
    - Budget alerts: Email/Slack at 80%, 95%, 100%
    - Block new jobs: Toggle to prevent jobs when budget exceeded
    - **Historical Comparison**:
    - Last 6 months spending: Bar chart
    - Average monthly spend: $423
    - Trend: Increasing (as team scales training usage)
  * Functional Requirements Acceptance Criteria:
    - **Page Access**: Accessible at `/dashboard/training-budget`, Navigation: Prominent link in main dashboard sidebar "üí∞ Budget", Permissions: All users see own budget, managers/admins see team budget, Page loads within 2 seconds (cached budget data)
    - **Summary Cards Row** (4 cards across top): **Card 1: Monthly Spending**: Large number: "$487.32" (current month spend), Secondary: "of $500.00 limit" (smaller, gray), Progress bar: 97% filled (color: red if >100%, yellow if 80-100%, green if <80%), Icon: üí∞ or üí≥; **Card 2: Remaining Budget**: Large number: "$12.68" (budget_limit - current_spend), Color: Red if negative (overspent), yellow if <20% remaining, green otherwise, Warning if negative: "‚ö†Ô∏è Over budget by $X", Icon: üíµ; **Card 3: Jobs This Month**: Large number: "12" (total jobs), Breakdown: "10 completed, 2 active, 0 failed" (smaller text), Click card filters job breakdown table to current month, Icon: üìä; **Card 4: Average Cost per Job**: Large number: "$40.61" (total_spend / total_jobs), Comparison to last month: "‚Üì $5.32 lower than last month" or "‚Üë $3.21 higher", Trend indicator (up/down arrow), Icon: üìà
    - **Spending Trend Graph** (main visualization): Chart type: Line chart (cumulative spending over time), X-axis: Days of current month (1-31), Y-axis: Cumulative cost ($0 - budget_limit + 20%), **Primary line**: Actual spending (solid blue), datapoints for each day spending occurred, Smooth curve connecting datapoints; **Budget limit line**: Horizontal dashed red line at $500 (budget limit), Label: "Budget Limit ($500)"; **Projected spending line**: Dotted gray line from current day to end of month, Extrapolates based on: current spending rate, active jobs' projected costs, historical spending patterns for this team/user, Formula: projected_month_end = current_spend + SUM(active_jobs.projected_remaining) + ((days_remaining / days_elapsed) √ó current_spend √ó seasonality_factor); **Alert zone shading**: Red transparent shading above budget limit line (indicates overspending zone), Yellow shading from 80% to 100% of budget (warning zone), Green shading below 80% (safe zone); **Annotations**: Markers on significant days (large job completions, budget increases), Hover tooltip shows: date, cumulative spend, daily spend, active jobs that day; Interactive: Click datapoint navigates to that day's jobs, Zoom controls to focus on date ranges, Toggle between cumulative and daily spend views
    - **Budget vs Forecast Panel**: Card displaying forecast analysis, **Current Status**: "Current Spend: $487.32" (as of today), "Budget Used: 97%" (progress bar); **Active Jobs Impact**: "Active Jobs: 2 jobs in progress", "Estimated Remaining Cost: $42-58" (range based on job projections), List active jobs: "Job A: $18-22 remaining", "Job B: $24-36 remaining"; **Month-End Forecast**: "Forecasted Month-End Spend: $529-545" (current + active + expected new jobs), Confidence: "Medium confidence (¬±$15)" based on historical variance, Comparison: "Projected to exceed budget by $29-45" (red text), Or: "Projected to stay within budget" (green text); **Recommendations**: IF forecast > budget: "‚ö†Ô∏è Action Required: Cancel low-priority jobs, or Increase budget limit to $550, or Defer new jobs to next month"; IF forecast < budget: "‚úì On track. Remaining capacity: $X for additional training runs"
    - **Per-Job Breakdown Table**: Table columns: [Checkbox] | Job Name | Status | Cost | % of Budget | Created By | Completed/Started At | [Actions]; Data: Shows all jobs in current budget period (calendar month or rolling 30 days), Default sort: Cost descending (most expensive first); **Cost Column**: Dollar amount with 2 decimals, Color coded: >$100 (red), $50-100 (yellow), <$50 (green), Hover shows cost breakdown (GPU, interruptions, storage); **% of Budget Column**: Percentage: "17.4%" (job_cost / monthly_budget), Visual bar indicator (mini progress bar in cell), Top cost drivers highlighted: "‚ö†Ô∏è High Impact" if >15% of budget; **Status Column**: Badge: "Completed" (green), "Active" (blue pulsing), "Failed" (red), "Cancelled" (orange); Pagination: 25 jobs per page with "Load More" or standard pagination; Bulk actions: Select multiple jobs via checkboxes, "Export Selected" (CSV), "View Cost Comparison" (multi-job analysis); Search/Filter: Search by job name, Filter by status, date range, creator, cost range, client/project
    - **Budget Controls Section**: Expandable panel: "Budget Settings", **Set Monthly Budget Limit**: Input field: "$500.00" (current limit), Min: $50, Max: $10,000 (or custom for enterprise), Save button: Requires confirmation "Update budget limit to $X?", Permissions: Manager/admin required for changes >20%, Audit log: All changes logged with who/when/why; **Budget Period Type**: Radio buttons: "Calendar Month" (Jan 1 - Jan 31), "Rolling 30 Days" (last 30 days from today), Affects all calculations (spending, forecast, history); **Budget Alert Thresholds**: Checkbox + percentage input: "‚òë Alert at 80% ($400)" - email/slack when reached, "‚òë Alert at 95% ($475)" - urgent notification, "‚òë Alert at 100% ($500)" - critical alert, "‚òê Alert at 110% ($550)" - overspend notification, Customize notification recipients for each threshold; **Job Blocking Settings**: Toggle: "Block new job creation when budget exceeded", If enabled: "Create New Job" button disabled when current_spend >= budget_limit, Error message: "Monthly budget exceeded. Increase limit or wait until next period.", If disabled: Jobs can be created over budget (warning shown), Useful for flexible budgets where overages acceptable
    - **Historical Comparison Section**: **6-Month Trend Bar Chart**: Bars for each of last 6 months (July, Aug, Sep, Oct, Nov, Dec), Height = spending that month, Color: Green if <80% of average, Yellow if 80-120%, Red if >120%, Horizontal line: Average monthly spend ($423), Hover: Shows exact spend, budget limit (if changed), job count; **Trend Analysis**: Text summary: "Your training spending has increased 23% over last 6 months", "Average monthly spend: $423", "Highest month: October ($548)", "Lowest month: July ($312)"; **Growth Projections**: "At current growth rate, projected spending next month: $534", "Consider increasing budget to $600 to accommodate growth", Seasonality detection: "Spending typically higher in Q4 (end-of-year projects)"; **Export Historical Data**: "Export 12-Month Report" button downloads CSV: month, total_spend, job_count, avg_cost_per_job, budget_limit, over_under_budget
    - **Additional Features**: **Budget Comparison**: Compare your budget utilization to team average: "You: 97% utilized, Team average: 84%", "Your avg cost per job: $40.61, Team average: $38.22", Insights: "You're slightly above team average. Consider using Conservative preset more often to reduce costs."; **Cost Optimization Tips**: Context-aware recommendations: "üí° Tip: 78% of your jobs use spot instances. Consider increasing to 90%+ for $X additional monthly savings.", "üí° Tip: Your average job costs $40.61. Conservative preset averages $32.18. Consider switching for non-urgent jobs."; **Budget Alerts Summary**: Shows recent alerts triggered: "80% threshold reached 3 days ago", "95% threshold reached today", Click to view alert details and actions taken
    - **Mobile Responsive**: Desktop (>1024px): Full dashboard with all panels visible; Tablet (768-1023px): Stack summary cards 2√ó2, condensed graph, paginated table; Mobile (<768px): Vertical card stack, simplified graph (daily view only), minimal table (job name, cost, status), Swipe gestures for time navigation
    - **Real-Time Updates**: Polling every 2 minutes: Updates spending numbers, active job costs, forecast, Dashboard shows "Last updated: 1 minute ago"; Push notifications (WebSocket): When threshold crossed, When month rolls over (reset), When budget limit changed
    - **Export & Reporting**: "Export Budget Report" button generates PDF: Cover page: Month, total spend, budget status, Summary cards visualization, Spending trend graph (full color), Per-job table (top 20 by cost), Historical comparison, Recommendations; Use case: Submit to finance team, manager review meetings, client billing backup

- **FR7.2.2:** Budget Alerts & Notifications
  * Description: System shall implement comprehensive budget alert system with threshold-based triggers (80%, 95%, 100% of monthly limit, active job budget risks), multi-channel delivery (email, Slack, in-app banners, SMS for critical), escalating alert severity with increasing thresholds, configurable recipient lists per alert level, actionable alert content with budget status summaries and quick action buttons, budget increase workflow with justification requirements and approval chains, complete audit logging of budget changes, daily digest summaries, alert suppression for acknowledged overages, and notification preferences management to enable proactive budget management, prevent surprise overages, facilitate rapid budget adjustments, and maintain financial oversight across teams.
  * Impact Weighting: Proactive Management / Risk Mitigation / Communication
  * Priority: High
  * User Stories: US7.2.2, US8.2.2
  * User Journey: UJ7.4.1 (Budget Alert Handling), UJ7.4.2 (Budget Limit Increases)
  * Tasks: [T-7.2.2], [T-8.2.2]
  * User Story Acceptance Criteria:
    - **Alert Triggers**:
    - 80% threshold: "You've used 80% of monthly training budget ($400 of $500)"
    - 95% threshold: "You've used 95% of monthly training budget ($475 of $500)"
    - 100% threshold: "Monthly training budget exceeded ($505 of $500)"
    - Budget exceeded during active job: "Active job may exceed budget. Cancel or increase limit."
    - **Alert Channels**:
    - Email: Sent to budget manager and finance stakeholders
    - Slack (optional): Posted to designated channel (#training-budget)
    - In-app notification: Banner on dashboard
    - **Alert Content**:
    - Current spending: $487.32 / $500.00 (97%)
    - Remaining budget: $12.68
    - Active jobs: 2 (estimated remaining cost: $42-58)
    - Forecast: Likely to exceed budget by $29-45
    - Actions: [Increase Budget Limit] [Cancel Active Jobs] [View Budget Dashboard]
    - **Increase Budget Limit**:
    - Click "Increase Budget Limit" button in alert email
    - Opens form: New limit, Justification (required), Approval (if required)
    - Submit request: Pending approval or immediately applied (based on permissions)
    - Notification: "Budget limit increased from $500 to $750"
    - **Budget Override Log**:
    - Audit trail of all budget limit changes
    - Who changed it, when, why (justification), old limit, new limit
    - Export log for financial reporting
    - **Notification Recipients** (from US8.2.2):
    - Configurable recipients: budget manager, finance team, operations
    - **Escalation Levels** (from US8.2.2):
    - 80% alert ‚Üí email only
    - 95% alert ‚Üí email + Slack
    - 100% alert ‚Üí email + Slack + in-app banner
    - **Daily Digest Option** (from US8.2.2):
    - "Your daily training budget summary" (total spent today, remaining budget, active jobs)
  * Functional Requirements Acceptance Criteria:
    - **Alert Trigger Detection**: Continuous monitoring: Every time training job cost updates (60s intervals), check if budget thresholds crossed, Trigger logic: IF current_spend >= (budget_limit √ó 0.80) AND NOT alerted_80: Send 80% alert, mark alerted_80 = true; IF current_spend >= (budget_limit √ó 0.95) AND NOT alerted_95: Send 95% alert; IF current_spend >= budget_limit AND NOT alerted_100: Send 100% alert; Once threshold triggered, don't re-trigger until next budget period (prevents spam)
    - **80% Threshold Alert**: Severity: Warning (yellow), Channels: Email only (least urgent), Recipients: Job creator, budget manager (if configured), Subject: "Training Budget Alert: 80% Used", Body: "You've used 80% of your monthly training budget. Current: $400 of $500 (80%), Remaining: $100, Active jobs: 2 (may consume additional $42-58), Forecast: On track to use $487 by month-end (within budget), Recommendation: Monitor spending closely. Consider postponing non-urgent training runs if nearing limit."; Action buttons: [View Budget Dashboard] [Adjust Spending Pace]; Alert logged: INSERT budget_alerts (threshold=80, triggered_at, notified_users)
    - **95% Threshold Alert**: Severity: High (orange), Channels: Email + Slack (escalated), Recipients: Job creator, budget manager, team lead, Email subject: "‚ö†Ô∏è Training Budget Alert: 95% Used", Slack message: "@budgetmanager Training budget 95% consumed. $475 of $500 used, $25 remaining. 2 active jobs may exceed budget. [View Dashboard]", In-app notification: Yellow banner on dashboard "‚ö†Ô∏è 95% of monthly budget used", Body content: "You've used 95% of your monthly training budget. Current: $475 of $500 (95%), Remaining: $25 (not enough for typical job), Active jobs: 2 (estimated cost: $42-58 remaining), Forecast: Likely to exceed budget by $17-33, Warning: Current active jobs will likely exceed budget. Consider: Cancelling low-priority jobs, Increasing budget limit, Waiting until next month for new jobs"; Action buttons: [Increase Budget Limit] [Cancel Jobs] [View Budget]
    - **100% Threshold Alert**: Severity: Critical (red), Channels: Email + Slack + In-app banner + SMS (optional, enterprise only), Recipients: All stakeholders (job creator, budget manager, finance team, operations), Email subject: "üö® CRITICAL: Training Budget Exceeded", High priority flag, Slack: "@channel in #training-budget, Training budget exceeded! $505 of $500 spent. Immediate action required.", In-app: Persistent red banner (cannot dismiss) "üö® Monthly budget exceeded. New job creation blocked.", SMS: "Bright Run Alert: Training budget exceeded $500 limit. Review immediately.", Body: "Your monthly training budget has been exceeded. Current: $505 of $500 (101%), Over budget: $5, Active jobs: 2 (estimated $42-58 remaining), Final month projection: $547-563, Critical: Budget limit exceeded. Immediate action required: 1. Increase budget limit to accommodate current activity, 2. Cancel active jobs to stay within budget, 3. Accept overage (requires manager approval)"; Action buttons: [Increase Budget Limit NOW] [Cancel Active Jobs] [Emergency Override]
    - **Active Job Budget Risk Alert**: Triggered when: Job's projected final cost + current monthly spend > budget limit, Even if current spend <100%, Real-time check: When job cost projections update, Alert: "‚ö†Ô∏è Budget Risk: Active job '{name}' projected to exceed budget", "Current spend: $487, Budget: $500, Remaining: $13, This job projected: $22-28, Risk: Budget will be exceeded by $9-15 if job continues", Actions: [Cancel This Job] [Increase Budget] [Continue Anyway (requires justification)]
    - **Email Alert Templates**: Professional HTML emails with Bright Run branding, Header: Company logo, alert icon (‚ö†Ô∏è/üö®), severity badge, Summary section: Budget status bar (visual progress), Key metrics table (current, remaining, forecast), Alert reason highlighted, Detailed analysis: Active jobs list with costs, Spending trend (last 7 days mini-chart), Projected impact, Action buttons: Large, prominent call-to-action buttons, Direct links (signed URLs, valid 7 days), Footer: Notification preferences link, Support contact, Unsubscribe (compliance)
    - **Slack Alert Integration**: Slack app integration: OAuth setup at `/settings/integrations/slack`, Select notification channel: #training-budget (recommended), Configure mention rules: "@channel for critical, @budgetmanager for high, no mention for warnings", Alert message format: Emoji indicator: ‚ö†Ô∏è (warning), üö® (critical), Plain text summary (mobile-friendly), Budget status: "Budget: $487/$500 (97% used)", Action buttons as Slack interactive components, Thread: Detailed breakdown posted in thread (keeps channel clean)
    - **In-App Banner Notifications**: Persistent banner across top of dashboard (cannot be dismissed for critical alerts), Color coding: Yellow (warning), Orange (high), Red (critical), Icon + message: "‚ö†Ô∏è 95% of budget used", Expandable: Click banner shows full alert details inline, Action buttons: Inline "Increase Budget" / "View Details", Dismissable: Non-critical alerts can be dismissed (saves preference), Reappears: Critical alerts reappear on page reload until resolved
    - **Budget Increase Workflow**: Click "Increase Budget Limit" button opens modal/form, Form fields: Current limit: "$500" (display only, not editable), New limit: Input field, min = current_spend (can't set below current), suggested = current_spend √ó 1.2, Justification: Textarea (required, min 50 characters), "Explain why budget increase needed", Approval required: Checkbox auto-checked if increase >20% or new limit >$1000, Approver: Dropdown (select manager), "Request will be sent to {manager} for approval"; Submit workflow: IF approval not required: UPDATE budgets SET monthly_limit = {new_limit}, justification = {text}, changed_by = {user}, changed_at = NOW(), Send confirmation: "Budget limit increased to ${new_limit}", Alert all stakeholders of change; IF approval required: INSERT budget_approval_requests (old_limit, new_limit, justification, requester, approver, status='pending'), Send email to approver: Subject: "Budget Limit Increase Request from {user}", Body: Current: $500, Requested: $750 (+50%), Justification: {text}, Current spend: $487 (will exceed if not approved), [Approve] [Deny] buttons with signed URLs, Requester notified: "Budget increase request submitted to {manager}. Awaiting approval."; Approval response: Approve: UPDATE budget + send confirmations, Deny: Notify requester with reason, request remains at old limit
    - **Budget Override Audit Log**: All budget changes logged: INSERT budget_audit_log (budget_id, old_limit, new_limit, changed_by, changed_at, justification, approval_required, approved_by, approved_at); Audit log display at `/dashboard/budget/audit-log`: Table: Date, Changed By, Old Limit, New Limit, Change %, Justification, Approver (if applicable), Sort by date (newest first), Filter: By user, by date range, by approval status, Export: CSV download for finance/compliance; Use cases: Financial audits, Budget planning reviews, Identifying spending pattern changes, Compliance requirements
    - **Notification Recipient Configuration**: Settings page: `/dashboard/settings/budget-notifications`, Per-threshold configuration: "80% Alert Recipients: [email@domain.com] [Add Recipient]", "95% Alert Recipients: [email1@] [email2@] [team-lead@] [Remove]", "100% Alert Recipients: [all-stakeholders@] [finance@]", Recipient types: Individual users (email), Distribution lists (team@, finance@), Role-based (all budget_managers, all team_leads), Slack channels (if integration enabled); Notification methods per recipient: Email: Always supported, Slack: If user has Slack connected, SMS: If user provided phone (enterprise only), In-app: Always for logged-in users; Save configuration: Requires manager permissions to add external recipients (finance@)
    - **Escalation Matrix**: **80% (Warning)**: Email to job creator + budget manager, No Slack, In-app: Dismissable banner, SMS: None, Response time: Informational, no urgent action; **95% (High)**: Email to creator + manager + team lead, Slack: Message with @budgetmanager mention, In-app: Persistent yellow banner, SMS: Optional (if enabled), Response expected: Within 4 hours; **100% (Critical)**: Email to all stakeholders (creator, manager, finance, ops), Slack: @channel mention in dedicated channel, In-app: Non-dismissable red banner, SMS: Enterprise customers only, Response required: Immediate action, job blocking active
    - **Daily Digest Summary**: Opt-in feature: User preference `/settings/notifications`, "‚òë Send daily budget digest", Time: 8 AM user's timezone, Delivery: Email only (not Slack/SMS), Content: Subject: "Your Daily Training Budget Summary - {Date}", Overview: "Monthly spend: $487 / $500 (97%)", "Spent today: $23.42 (2 jobs completed)", "Active jobs: 2 ($18 and $24 remaining)", Forecast: "Projected month-end: $534 (over budget by $34)", Yesterday's activity: List of completed jobs with costs, Upcoming: "3 queued jobs (estimated $67 total)", Action items: "Consider: Cancelling Job X ($24) to stay within budget"; Digest aggregates daily activity, reduces alert fatigue
    - **Alert Suppression**: For acknowledged budget overages: User can "Acknowledge Overage" in alert, Suppresses repeat 100% alerts for rest of month, Assumes: User aware, budget increase approved or overage accepted, Prevents daily alert spam once situation known; Suppression logged: Who acknowledged, when, acceptance note (optional); Re-enables: Next budget period (fresh start)
    - **Alert Analytics**: Track alert effectiveness: Metrics: Alert response rate (% of alerts acted upon within 24 hours), Budget increase frequency (how often limits raised), Overage frequency (how often exceeded despite alerts), Average time to resolution, Insights: "80% of 100% alerts result in budget increase within 1 hour", "Teams with daily digest enabled have 23% fewer budget overages", Use insights to improve alert thresholds and messaging
    - **Alert Preferences Management**: User settings page: Granular control over notifications, Per-alert-type toggles: "Budget Alerts: ‚òë 80% ‚òë 95% ‚òë 100%", "Job Completion: ‚òë Email ‚òê Slack", "Error Alerts: ‚òë Critical only", Channel preferences: "Preferred channel: Email (primary), Slack (secondary)", "Quiet hours: 10 PM - 7 AM (no email alerts)", "Weekend delivery: ‚òê Send alerts on weekends", Save preferences: Immediate effect, Applies user-wide (not per-job)
    - **Emergency Budget Override**: For critical situations (client deadline, urgent delivery): "Emergency Override" button in 100% alert, Requires: Manager role or higher, Justification (mandatory, 100+ chars), Bypasses approval workflow, Immediately increases budget by preset amount (e.g., +50% or +$500), Logged as emergency action: Flagged for post-hoc review, Subject to audit: Finance team reviews all emergency overrides monthly, Use sparingly: Intended for true emergencies only, prevents blocking critical work

- **FR7.3.1:** Spot vs On-Demand Cost Analysis
  * Description: System shall implement comprehensive spot versus on-demand cost analysis reporting total spot savings, equivalent on-demand costs, savings percentages, per-job cost comparisons with interruption counts, interruption impact analysis calculating recovery overhead, net savings after overhead, annualized ROI projections, strategic recommendations for GPU type selection, visual cost comparison charts, historical savings trends, and exportable PDF reports to demonstrate cost efficiency, justify infrastructure investments, guide GPU selection strategy, and provide executive-level ROI metrics for financial planning and stakeholder communication.
  * Impact Weighting: Cost Efficiency / ROI Demonstration / Strategic Planning
  * Priority: Medium
  * User Stories: US7.3.1
  * User Journey: UJ7.5.1 (Cost Efficiency Analysis), UJ7.5.2 (Strategic GPU Selection)
  * Tasks: [T-7.3.1]
  * User Story Acceptance Criteria:
    - **Cost Optimization Report** on budget dashboard
    - **Spot Instance Savings**:
    - Total spot cost: $387.32
    - Equivalent on-demand cost: $1,243.18
    - Total savings: $855.86 (69% cheaper)
    - **Per-Job Comparison**:
    - Table: Job Name, Spot Cost, Equivalent On-Demand Cost, Savings, Interruptions
    - Example: "Job ABC: $48 (spot) vs $146 (on-demand) = $98 saved, 2 interruptions"
    - **Interruption Impact**:
    - Total spot interruptions: 23 (across 12 jobs)
    - Average interruptions per job: 1.9
    - Interruption cost overhead: $28.42 (checkpoint recovery time)
    - Net savings after overhead: $827.44
    - **ROI Calculation**:
    - Monthly spot savings: $855.86
    - Annualized savings: $10,270 (if usage remains constant)
    - Justifies investment in training infrastructure
    - **Recommendation**:
    - "Continue using spot instances for 90%+ of jobs"
    - "Reserve on-demand for urgent client deliveries"
    - "Current strategy saves $10k+ annually"
    - Export cost optimization report as PDF for stakeholders
  * Functional Requirements Acceptance Criteria:
    - **Cost Optimization Report Section**: Accessible on budget dashboard: Section header "üí∞ Cost Optimization: Spot vs On-Demand", Expandable panel (collapsed by default, expandable for details); Data period: Current month by default, filterable to: Last 30 days, Last 90 days, Last 12 months, All time, Custom date range
    - **Spot Instance Savings Summary**: Large prominent metrics card, **Total Spot Cost**: "$387.32" (sum of actual spot job costs), Breakdown: "12 spot jobs completed this month"; **Equivalent On-Demand Cost**: "$1,243.18" (hypothetical cost if all spot jobs run on-demand), Calculation: spot_job_hours √ó on_demand_hourly_rate ($7.99/hr for H100); **Total Savings**: "$855.86" huge, bold, green, Percentage: "69% cheaper" (savings / on_demand_cost √ó 100), Visual: Large green ‚Üì arrow with savings amount; **Comparison Bar**: Horizontal stacked bar chart: Spot cost (blue, $387), Savings (green, $855), Total width = on-demand cost ($1,243), Shows visually how much saved
    - **Per-Job Cost Comparison Table**: Table columns: Job Name | GPU Type | Actual Cost | On-Demand Equivalent | Savings | Interruptions | Status; Data rows: Job 1: "Elena Q1 Training | Spot | $48.32 | $146.18 | $97.86 (67%) | 2 | ‚úì", Job 2: "Test Aggressive | Spot | $23.15 | $68.42 | $45.27 (66%) | 0 | ‚úì", Job 3: "Client Demo | On-Demand | $87.42 | $87.42 | $0 (0%) | 0 | ‚úì", Job 4: "Elena Q2 Training | Spot | $51.28 | $156.32 | $105.04 (67%) | 3 | ‚úì"; Sort: Default by savings descending (highest savings first), sortable by any column; Highlight: Jobs with 0 interruptions highlighted green (perfect spot execution), Jobs with >3 interruptions highlighted yellow (high interruption rate); Filter: "Show spot only" / "Show on-demand only" / "Show all"
    - **Interruption Impact Analysis**: **Total Interruptions**: "23 interruptions across 12 spot jobs", "Average: 1.9 interruptions per job"; **Interruption Distribution**: Histogram: X-axis: Number of interruptions (0, 1, 2, 3, 4+), Y-axis: Job count, Bars show: "3 jobs with 0 interruptions", "4 jobs with 1", "3 jobs with 2", "2 jobs with 3+", Success metric: "75% of spot jobs had ‚â§2 interruptions (acceptable)"; **Recovery Overhead Cost**: Calculation: recovery_overhead = SUM(interruption_recovery_time_minutes) √ó spot_hourly_rate, Example: "23 interruptions √ó avg 7.4 min recovery √ó $2.49/hr = $28.42", Display: "Interruption overhead: $28.42" (3.7% of spot cost); **Net Savings After Overhead**: "Net savings: $827.44" (total_savings - interruption_overhead), "Still 67% cheaper than on-demand after accounting for interruptions", Green highlight: Demonstrates spot is worth it despite interruptions
    - **Interruption Rate Analysis**: Spot interruption rate = (total_interruptions / total_spot_jobs) √ó 100, Display: "Interruption rate: 19% per job" (typical: 10-30% depending on datacenter demand), Trend: "‚Üì 3% lower than last month" or "‚Üë 5% higher", Correlation: "Interruption rate highest during peak hours (9 AM - 5 PM PST): 28%", "Off-peak hours (5 PM - 9 AM): 12% interruption rate", Recommendation based on rate: If >30%: "‚ö†Ô∏è High interruption rate. Consider: Using on-demand for critical jobs, Scheduling spot jobs during off-peak hours, Switching to less-congested datacenter (if available)"; If 10-20%: "‚úì Normal interruption rate. Current spot strategy optimal."; If <10%: "‚úì Excellent! Very low interruption rate. Continue spot-heavy strategy."
    - **ROI Calculation & Projection**: **Monthly Savings**: "$855.86 saved this month using spot instances"; **Annualized Projection**: "Projected annual savings: $10,270" (monthly_savings √ó 12), Assumption note: "Assumes current usage levels continue", Confidence: "Medium confidence (¬±20%) based on 3 months historical data"; **ROI Narrative**: "Your spot instance strategy saves $10k+ annually compared to on-demand-only approach.", "This cost efficiency justifies investment in: Robust checkpoint recovery system, Automated retry mechanisms, Training infrastructure automation", "Spot savings fund ~25% of annual training budget (enabling more model iterations)"; **Cumulative Savings**: Line chart showing cumulative savings over time: X-axis: Months, Y-axis: Cumulative savings ($), Line shows savings accumulation (should be steadily increasing), Milestone markers: "$10k saved" when reached, Projected trendline: Dotted line showing next 6 months projected savings
    - **Strategic Recommendations**: Context-aware recommendations based on usage patterns: **Current Strategy Summary**: "Your GPU selection: Spot: 85% (11 jobs), On-demand: 15% (2 jobs), Savings rate: 69% vs on-demand-only"; **Recommendation 1** (if spot usage <80%): "üí° Opportunity: Increase spot usage from 85% to 95% for additional $X monthly savings. Reserve on-demand only for: Client deliveries with tight deadlines, Jobs >$100 where interruption risk unacceptable, Production deployments requiring guaranteed completion"; **Recommendation 2**: "‚úì Current strategy optimal. Continue using spot for 90%+ of jobs.", "Your mix (85% spot, 15% on-demand) balances cost efficiency with reliability."; **Recommendation 3** (if high interruption rate): "‚ö†Ô∏è High interruption rate (28%) reducing spot efficiency. Consider: Scheduling more jobs during off-peak hours (5 PM - 9 AM), Using on-demand for long-running jobs (>12 hours projected), Exploring alternate datacenters with lower congestion"; **Recommendation 4** (cost-conscious): "To maximize savings: Always use spot for: Test/experiment jobs, Non-urgent training runs, Jobs with flexible completion timelines, Use on-demand only for: Client deadline commitments, Urgent production needs, Jobs already failed 2√ó on spot"
    - **Visual Cost Comparison Chart**: Side-by-side bar chart: 2 bars: "Your Actual Cost (Spot-Heavy Strategy)" = $472 total (spot + on-demand jobs), "All On-Demand Alternative" = $1,330 hypothetical, Difference highlighted: "$858 saved (65%)", Color: Your cost (green), All on-demand (red), Arrow showing savings magnitude; Donut chart breakdown: Spot cost: $387 (82%), On-demand cost: $85 (18%), Savings portion: $855 (shown as "avoided cost" in legend), Visual shows how small actual spend is vs avoided cost
    - **Historical Savings Trend**: Multi-month view showing savings over time: Table: Month | Spot Cost | On-Demand Equivalent | Savings | Savings %, Jan: $421 | $1,287 | $866 (67%), Feb: $398 | $1,195 | $797 (67%), Mar: $387 | $1,243 | $855 (69%); Trend analysis: "Your savings rate has been consistent at 67-69% over last 3 months", "Spot strategy working effectively with minimal variation", "No significant degradation in savings despite increased usage"; Line chart: X-axis: Months, Y-axis: Savings %, Line should be relatively flat (indicating consistent strategy), Target line: 60% savings rate (industry benchmark)
    - **Benchmarking**: Compare to industry/internal benchmarks: "Your savings rate: 69%", "Bright Run average: 64% (you're above average ‚úì)", "Industry benchmark: 55-65% typical for LoRA training", "Your efficiency rank: Top 15% of Bright Run users", Insight: "Your spot strategy is highly effective. Share best practices with team."
    - **Export Cost Optimization Report**: "Export Report" button generates professional PDF: Cover page: "Cost Optimization Report: Spot vs On-Demand Analysis", Company logo, date range, total savings highlighted, Executive summary: Key metrics (savings, ROI, strategy), 1-paragraph summary for stakeholders, Detailed analysis: Spot vs on-demand comparison (charts and tables), Per-job breakdown (top 10 by savings), Interruption analysis with charts, ROI calculation and projections, Strategic recommendations section, Methodology appendix: Explains calculation formulas, Uses: Board presentations, Finance reporting, Stakeholder updates, Budget justification, Strategic planning; CSV export: Raw data table with all jobs for detailed analysis
    - **Alert Integration**: If savings rate drops significantly: "‚ö†Ô∏è Cost Efficiency Alert: Your spot savings rate dropped from 69% to 52% this month.", "Possible causes: Higher interruption rate (28% vs 19% last month), More on-demand jobs (5 vs 2 last month), Investigation recommended: Review job GPU selection decisions, Consider off-peak scheduling for spot jobs", Action: Link to detailed cost report for analysis
    - **Team-Level Aggregation** (managers/admins): View team-wide cost optimization: "Team Spot Savings: $3,247 this month", "Team members ranked by cost efficiency: Sarah (72% savings rate), John (69%), Maria (58%), ..."); Identify optimization opportunities: "Maria using on-demand for 45% of jobs (team avg: 18%). Coaching opportunity.", "Team could save additional $X/month by optimizing GPU selection"

- **FR7.3.2:** Cost Attribution by Client/Project
  * Description: System shall implement comprehensive cost attribution enabling client and project tagging during job creation, maintaining client/project master lists with create-new capabilities, generating attribution reports showing per-client/project job counts, total costs, averages, and date ranges, calculating project profitability with revenue inputs, training costs, other costs, profit and margin percentages, providing pricing insights with cost-to-revenue ratios and recommended pricing bands, supporting budget allocation by client priority tiers, and exporting detailed attribution data for accounting integration to enable accurate project costing, profitability analysis, client billing, strategic pricing decisions, and financial planning.
  * Impact Weighting: Financial Planning / Profitability Analysis / Pricing Strategy
  * Priority: Medium
  * User Stories: US7.3.2
  * User Journey: UJ7.6.1 (Cost Attribution), UJ7.6.2 (Profitability Analysis)
  * Tasks: [T-7.3.2]
  * User Story Acceptance Criteria:
    - **Client/Project Tagging**:
    - When creating training job, optionally assign to client or project
    - Dropdown: Existing clients/projects or create new
    - Example: "Client: Acme Financial Advisors", "Project: Q1 2025 AI Enhancement"
    - **Cost Attribution Report**:
    - Table: Client/Project, Total Jobs, Total Cost, Average Cost per Job, Date Range
    - Example: "Acme Financial: 5 jobs, $287.32, $57.46 avg, Jan-Mar 2025"
    - **Project Profitability**:
    - For each project, show: Revenue, Training Cost, Other Costs, Profit, Margin %
    - Example: "Acme Financial Q1 Project: $25k revenue, $287 training, $2k other, $22.7k profit (91% margin)"
    - **Pricing Insights**:
    - Average training cost per client: $52
    - Recommended pricing: $15k-30k (287-577x training cost)
    - Current margin: 91-97% depending on pricing tier
    - **Budget Allocation**:
    - Allocate monthly budget by client priority: "$200 for Priority A clients, $150 for Priority B, $150 for experiments"
    - Export cost attribution as CSV for accounting/finance teams
    - Use case: Finance team calculates true project costs for profitability analysis
  * Functional Requirements Acceptance Criteria:
    - **Client/Project Tagging During Job Creation**: Job configuration form includes optional section: "Cost Attribution", **Client Assignment**: Dropdown: "Assign to client (optional)", Options: Existing clients from clients table OR "‚ûï Create New Client", If "Create New": Inline form: Client name (required), Client ID/code (optional, for accounting integration), Industry (dropdown: Financial Services, Insurance, Wealth Management, Other), Priority tier (A/B/C for budget allocation), Save creates new client, immediately available in dropdown; **Project Assignment**: Dropdown: "Assign to project (optional)", Filtered by selected client (if client selected), shows only that client's projects, Options: Existing projects OR "‚ûï Create New Project", If "Create New": Inline form: Project name, Client (pre-filled if selected above), Project code (for accounting), Start date, End date (optional), Projected revenue (optional, for profitability calc), Save creates project; **Metadata Storage**: UPDATE training_jobs SET client_id = {id}, project_id = {id}, Tags displayed on job details: "Client: Acme Financial", "Project: Q1 2025 AI Enhancement", Edit capability: Can change client/project assignment post-creation (in case of error)
    - **Client/Project Master Data**: **Clients Table**: Schema: clients (id, name, client_code, industry, priority_tier, created_at, created_by), Stored centrally for all users/teams, Management interface: `/dashboard/clients`, CRUD operations: Create, Read, Update, Archive (soft delete - don't delete if jobs associated); **Projects Table**: Schema: projects (id, name, project_code, client_id, start_date, end_date, projected_revenue, other_costs, status, created_at), Status: Active, Completed, On-Hold, Cancelled, Management: `/dashboard/projects`, Link to client: Each project belongs to one client
    - **Cost Attribution Report Page**: Accessible at `/dashboard/cost-attribution`, Dual view tabs: "By Client" | "By Project", Date range filter: "Last 30 days", "Last 90 days", "Custom range", "All time", Export button: "Export Attribution Report" (CSV/PDF)
    - **By Client View**: Table columns: Client Name | Industry | Jobs | Total Cost | Avg Cost/Job | Date Range | Actions; Example rows: "Acme Financial | Financial Services | 5 jobs | $287.32 | $57.46 | Jan-Mar 2025 | [View Details]", "Beta Insurance | Insurance | 3 jobs | $142.18 | $47.39 | Feb-Mar 2025 | [View Details]", "Internal R&D | - | 8 jobs | $312.45 | $39.06 | Jan-Mar 2025 | [View Details]", "Unassigned | - | 12 jobs | $487.21 | $40.60 | Jan-Mar 2025 | -"; Sort: Default by total cost descending (highest-spending clients first), Sortable by any column; Summary row at top: "Total: 28 jobs, $1,229.16 across 4 clients"; Drill-down: Click client row expands to show all jobs for that client (inline table), Or click "[View Details]" navigates to client detail page
    - **By Project View**: Table: Project Name | Client | Status | Jobs | Total Cost | Revenue | Profit | Margin % | Date Range; Example: "Q1 2025 AI Enhancement | Acme Financial | Completed | 5 | $287.32 | $25,000 | $22,712.68 | 91% | Jan-Mar 2025", "Insurance Chatbot V2 | Beta Insurance | Active | 3 | $142.18 | $18,000 | - | - | Feb-Mar 2025" (active projects may not have revenue entered yet), "Voice Model Pilot | Acme Financial | Completed | 2 | $98.42 | $8,500 | $8,401.58 | 99% | Jan 2025"; Sort: Default by margin % descending (most profitable first); Filters: Status (Active/Completed/All), Client dropdown, Margin threshold (">80%", "<50%", etc.)
    - **Project Profitability Calculation**: For each project: **Training Cost**: SUM(job costs for all jobs assigned to project), Automatically calculated from job records; **Other Costs** (user input): Labor costs (team time spent), Infrastructure costs (storage, APIs beyond training), Third-party services (data labeling, consultants), Input via project edit form: "Other Costs: $2,000", Breakdown optional (free text notes); **Revenue** (user input): Contract value or billing amount, Input: "Project Revenue: $25,000", Optional for internal/R&D projects; **Profit Calculation**: profit = revenue - training_cost - other_costs, Example: $25,000 - $287.32 - $2,000 = $22,712.68; **Margin Calculation**: margin_pct = (profit / revenue) √ó 100, Example: ($22,712.68 / $25,000) √ó 100 = 90.9% ‚âà 91%; Display: "Profit: $22,712.68 (91% margin)" (large, green if >70%, yellow if 40-70%, red if <40%)
    - **Pricing Insights Dashboard**: Section: "Pricing Intelligence", **Average Training Cost**: "Average training cost per client: $52.18" (total_training_costs / num_clients), "Median cost: $47.39" (less affected by outliers), Range: "Min: $18.42, Max: $287.32"; **Cost-to-Revenue Ratios**: Historical analysis: "Typical project: $287 training cost ‚Üí $25k revenue = 87√ó multiplier", "Your pricing range: 287√ó to 577√ó training cost", Recommendation: "Sustainable pricing: 200-500√ó training cost (40-60% margin after all expenses)"; **Recommended Pricing Bands**: Based on training cost: If training_cost < $50: "Recommended pricing: $10k-20k", If $50-150: "Recommended: $20k-40k", If $150-300: "Recommended: $40k-80k", If >$300: "Recommended: $80k-150k+", Caveat: "Adjust based on: Client size/budget, Model complexity, Customization level, Ongoing support requirements, Competitive landscape"; **Current Margins**: Display all project margins: "Your projects: 87%, 91%, 94%, 99%", "Average margin: 92%", "All projects >85% margin (healthy)", Benchmark: "Target margin: 70-85% (yours: 92% ‚úì excellent)"
    - **Budget Allocation by Client Priority**: Feature for proactive budget management, **Priority Tiers**: Assign clients to tiers: Priority A (strategic, high-value): $200/month allocated, Priority B (standard clients): $150/month, Priority C (experimental, low-priority): $100/month, Internal R&D: $50/month; **Allocation Dashboard**: Table: Client | Priority | Allocated Budget | Spent (MTD) | Remaining | Utilization %; Example: "Acme Financial | A | $200 | $142.18 | $57.82 | 71%", "Beta Insurance | B | $150 | $87.32 | $62.68 | 58%", "Internal R&D | - | $50 | $23.15 | $26.85 | 46%"; **Allocation Alerts**: Alert when client approaching their allocation: "‚ö†Ô∏è Acme Financial at 92% of allocated budget ($184 of $200). Consider: Pausing non-urgent jobs for this client, Increasing allocation for Priority A client, Billing client for additional training work"; **Monthly Rollover**: Reset allocations at start of each month, Option: "Rollover unused budget to next month" (if enabled, unused $57 carries forward)
    - **Unassigned Cost Tracking**: Track jobs not assigned to any client/project: "Unassigned Costs: $487.21 (12 jobs)", Percentage: "40% of training costs unattributed", Recommendation: "‚ö†Ô∏è High unassigned cost percentage. Action: Retroactively assign jobs to clients/projects for accurate attribution, Enforce client assignment for new jobs (make field required), Identify if internal R&D should be tracked as separate 'client'"; Impact: "Unassigned costs inflate overhead, reduce visibility into per-client profitability"
    - **Export Cost Attribution Data**: **CSV Export**: Columns: Client, Project, Job Name, Job ID, Cost, Created At, Completed At, Duration, GPU Type, Creator, Status, Rows: All jobs with attribution metadata, Filename: `cost-attribution-{date_range}-{timestamp}.csv`, Use case: Import into accounting software (QuickBooks, Xero), Financial reporting, Client billing backup; **PDF Report**: Professional formatted report: Executive summary: Total attributed costs by client, Project profitability table, Pricing insights summary, Detailed job breakdown per client/project, Charts: Cost by client pie chart, Margin by project bar chart, Trend analysis if multi-period; Use case: Board presentations, Client reporting, Internal financial reviews
    - **Integration with Accounting Systems** (future): API endpoints for attribution data: GET /api/cost-attribution/clients, GET /api/cost-attribution/projects/{id}, Webhooks: Notify when job completes (post cost to accounting), Map to accounting categories: Client ‚Üí Customer, Project ‚Üí Job/Matter, Training cost ‚Üí COGS or Operating Expense; Supported systems: QuickBooks Online (OAuth integration), Xero (API integration), Manual CSV import (for others)
    - **Client Detail Page**: Navigate from client name in tables to `/dashboard/clients/{id}`, Page shows: Client profile: Name, industry, priority tier, created date, All jobs for this client: Table with job details and costs, Total spend: "Total spent: $287.32 across 5 jobs", "Average per job: $57.46", Projects for this client: List of projects with profitability, Cost trend: Line chart showing cumulative cost over time, Profitability summary: If projects have revenue: "Total revenue: $33.5k, Total costs: $2.7k, Total profit: $30.8k (92% margin)", Budget allocation: Current month allocation and utilization; Actions: "Create New Project for This Client", "Assign Unassigned Jobs to This Client", "Export Client Cost Report"
    - **Project Detail Page**: `/dashboard/projects/{id}`, Shows: Project metadata: Name, client, status, dates, revenue, other costs, All jobs: Jobs assigned to this project with individual costs, Cost breakdown: Training: $287.32, Other: $2,000, Total: $2,287.32, Profitability: Revenue: $25,000, Profit: $22,712.68, Margin: 91%, Timeline: Gantt-style view of jobs over project duration, Budget tracking: If project has budget: "Budget: $3,000, Spent: $2,287 (76%), Remaining: $713"; Actions: "Edit Project Details", "Add Revenue/Costs", "Mark as Completed", "Export Project Report"
    - **Cost Attribution Analytics**: Team-level insights (managers/admins): "Top Revenue Clients: Acme Financial ($58k), Beta Insurance ($42k)", "Most Profitable Project: Voice Model Pilot (99% margin)", "Highest Training Cost: Acme Q1 Enhancement ($287)", "Unattributed Cost Rate: 15% (target: <10%)", Trends: "Client acquisition cost (training): Avg $142 per new client", "Average project value: $23k", "Average margin: 91%"; Strategic insights: "Priority A clients generate 62% of revenue but only 18% of training costs (efficient)", "Consider: Raising prices for clients with <70% margins, Allocating more budget to high-margin clients, Converting experimental clients (Priority C) to standard (Priority B) if successful"
