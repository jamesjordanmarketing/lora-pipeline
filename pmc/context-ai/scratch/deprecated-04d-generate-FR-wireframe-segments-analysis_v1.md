# Analysis of `04d-generate-FR-wireframe-segments_v1.js`

This document provides an operational analysis of the `04d-generate-FR-wireframe-segments_v1.js` script, detailing its inputs, logic, and outputs without delving into deep technical implementation details.

## 1. Input Templates, References & Examples

The script relies on four primary input sources to function. It combines static templates with project-specific dynamic data.

### Templates
These markdown files serve as the "skeleton" for the prompts generated by the script.
*   **Task Creation Template:** `product/_prompt_engineering/04-FR-with-wireframes-create-tasks_v1.md`
    *   Used to generate prompts for individual Functional Requirements (FRs).
*   **Execution Template:** `product/_prompt_engineering/04-FR-with-wireframes-execution-prompts_v1.md`
    *   Used to generate a high-level orchestration prompt for an entire section (Stage).

### References & Data Sources
*   **Functional Requirements (Main Input):** `product/03-[project-abbreviation]-functional-requirements.md`
    *   The source of truth. The script parses this file to find all the "Stages" (E01, E02, etc.) and the specifc "Functional Requirements" (FR1.1, FR1.2) contained within them.
*   **Journey Mapping Data:** `product/_mapping/journey-to-wireframe-mapping.json`
    *   A JSON file containing emotional and strategic goals for each stage (e.g., "Goals", "Emotional Requirements", "Progressive Disclosure Levels"). This data is injected into the prompts to ensure the AI understands the user journey context.

## 2. Input Spec

The script operates based on strict formatting conventions in the input files and specific command-line arguments.

### Command Line Spec
The script requires two arguments when running:
1.  **Project Name:** (e.g., "Bright Run LoRA Fine-Tuning Training Data Platform")
2.  **Project Abbreviation:** (e.g., "bmo") - This is used to construct file paths and naming conventions (replacing `[prod-abbr]`).

### Functional Requirements Spec
The `03-...-functional-requirements.md` file must follow this Markdown structure:
*   **Sections:** Must be defined with `## [Number]. [Title]`. The script uses this to detect "Stages" (e.g., "## 1. Onboarding" becomes Section E01).
*   **FR IDs:** Functional Requirements must be bolded and colon-separated: `**FR[x].[x].[x]:**`. The script scans for this exact pattern to identify individual requirements.

### Journey Mapping Spec
The JSON file must have keys corresponding to stages (e.g., `stage1`, `stage2`) containing specific sub-keys: `goals`, `emotions`, `progressive` (with level1/2/3), and `success`.

## 3. Operational Flow (What Running the Script Does)

When executed, the script performs the following sequence of operations:

1.  **Validation:** It verifies that all necessary input files (Requirements, Templates, Journey Data) exist; otherwise, it stops.
2.  **Parsing:** It reads the entire Functional Requirements file and splits it into logical "Sections" or "Stages" (E01, E02, etc.).
3.  **Iteration:** It loops through every identified section one by one.
4.  **Extraction:** For each section, it finds every unique Functional Requirement ID (e.g., FR1.1.0, FR1.2.5).
5.  **Blueprint Generation (Prompt Construction):**
    *   **Context Injection:** It looks up the "Journey Mapping" data for the current stage and prepares a text block summarizing user goals and emotional requirements.
    *   **Variable Replacement:** It takes the *Templates* and replaces placeholders (like `[FR_NUMBER]`, `[SECTION_ID]`, `[STAGE_NAME]`) with the actual data parsed from the file.
    *   **Line Calculation:** It intelligently calculates line numbers to help the AI referencing these files know exactly where definitions are located.
6.  **File Writing:** It saves the fully constructed prompt files to the `product/_mapping/fr-maps/prompts/` directory.

## 4. Prompts Created & Their Purpose

The script generates **two distinct types of prompt files** for every single section (Stage) of the project.

### A. The "Combined Generator" Prompt
*   **File Name:** `04-FR-wireframes-prompt-E[XX].md` (where XX is the section number).
*   **What it does:** This file contains a **collection of individual prompts**, one for every single FR in that section.
*   **Purpose:** It serves as a library of specific instructions. An AI can look up "FR1.3.0" in this file and find a bespoke prompt designed specifically to generate tasks or wireframes for *that specific requirement*, enriched with the correct emotional and journey context.

### B. The "Execution" Prompt
*   **File Name:** `04-FR-wireframes-execution-prompt-E[XX].md`.
*   **What it does:** This is a single, higher-level prompt for the entire section.
*   **Purpose:** This is the "Driver" prompt. It instructs the AI on how to process the entire stage. It likely tells the AI to:
    1.  Read the "Combined Generator" file (A).
    2.  Process the FRs listed.
    3.  Generate the final output file (expected to be `04-[abbr]-[XX]-task-list_v2.md`).
    4.  Ensure consistency across the entire stage.

**Summary:** The script transforms a static requirements document into a set of highly specific, context-aware instructions (Prompts) that allow an AI to autonomously generate wireframe tasks and details for each part of the system.
