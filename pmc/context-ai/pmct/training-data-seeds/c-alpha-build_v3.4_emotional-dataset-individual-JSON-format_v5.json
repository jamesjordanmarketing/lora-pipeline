{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://brightrun.ai/schemas/emotional-lora-individual-v5.0.json",
  "title": "Individual Conversation JSON Schema v5.0",
  "description": "Schema for single enriched conversation files - output of the enrichment pipeline. v5.0: Aligned with Full Training File schema v5.0 and removed blind-spot detection.",
  "type": "object",
  "required": [
    "dataset_metadata",
    "consultant_profile",
    "training_pairs"
  ],
  "additionalProperties": false,
  "properties": {
    "dataset_metadata": {
      "type": "object",
      "description": "File-level metadata for audit trail and provenance tracking",
      "required": [
        "dataset_name",
        "version",
        "created_date",
        "vertical",
        "consultant_persona",
        "target_use",
        "conversation_source",
        "quality_tier",
        "total_conversations",
        "total_turns",
        "notes"
      ],
      "properties": {
        "dataset_name": {
          "type": "string",
          "pattern": "^fp_conversation_[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$",
          "description": "Unique identifier in format: fp_conversation_<uuid>"
        },
        "version": {
          "type": "string",
          "pattern": "^\\d+\\.\\d+\\.\\d+$",
          "description": "Semantic version (always 1.0.0 for individual files)",
          "default": "5.0.0"
        },
        "created_date": {
          "type": "string",
          "format": "date",
          "description": "ISO date format (YYYY-MM-DD)"
        },
        "vertical": {
          "type": "string",
          "const": "financial_planning_consultant",
          "description": "Business domain"
        },
        "consultant_persona": {
          "type": "string",
          "description": "Full persona identifier with credentials",
          "examples": [
            "Elena Morales, CFP - Pathways Financial Planning"
          ]
        },
        "target_use": {
          "type": "string",
          "const": "LoRA fine-tuning for emotionally intelligent chatbot",
          "description": "Intended training purpose"
        },
        "conversation_source": {
          "type": "string",
          "enum": [
            "synthetic_platform_generated",
            "synthetic_expert_authored",
            "real_anonymized"
          ],
          "description": "Source type of the conversation"
        },
        "quality_tier": {
          "type": "string",
          "enum": [
            "seed_dataset",
            "production",
            "experimental",
            "rejected"
          ],
          "description": "Quality classification level"
        },
        "total_conversations": {
          "type": "integer",
          "const": 1,
          "description": "Always 1 for individual files"
        },
        "total_turns": {
          "type": "integer",
          "minimum": 1,
          "description": "Number of turns in this conversation"
        },
        "notes": {
          "type": "string",
          "description": "Generation context (template name, special conditions, etc.)"
        }
      }
    },
    "consultant_profile": {
      "type": "object",
      "description": "Static persona configuration for the AI assistant being trained",
      "required": [
        "name",
        "business",
        "expertise",
        "years_experience",
        "core_philosophy",
        "communication_style"
      ],
      "properties": {
        "name": {
          "type": "string",
          "description": "Full name with credentials",
          "examples": [
            "Elena Morales, CFP"
          ]
        },
        "business": {
          "type": "string",
          "description": "Business or practice name",
          "examples": [
            "Pathways Financial Planning"
          ]
        },
        "expertise": {
          "type": "string",
          "description": "Area of specialization"
        },
        "years_experience": {
          "type": "integer",
          "minimum": 0,
          "description": "Years of professional experience"
        },
        "core_philosophy": {
          "type": "object",
          "description": "Five core principles guiding the consultant's approach",
          "required": [
            "principle_1",
            "principle_2",
            "principle_3",
            "principle_4",
            "principle_5"
          ],
          "properties": {
            "principle_1": {
              "type": "string"
            },
            "principle_2": {
              "type": "string"
            },
            "principle_3": {
              "type": "string"
            },
            "principle_4": {
              "type": "string"
            },
            "principle_5": {
              "type": "string"
            }
          }
        },
        "communication_style": {
          "type": "object",
          "description": "Communication approach and guidelines",
          "required": [
            "tone",
            "techniques",
            "avoid"
          ],
          "properties": {
            "tone": {
              "type": "string",
              "description": "Overall tone description"
            },
            "techniques": {
              "type": "array",
              "items": {
                "type": "string"
              },
              "minItems": 1,
              "description": "Communication techniques to use"
            },
            "avoid": {
              "type": "array",
              "items": {
                "type": "string"
              },
              "minItems": 1,
              "description": "Things to avoid in communication"
            }
          }
        }
      }
    },
    "training_pairs": {
      "type": "array",
      "description": "Array of turn objects, each representing one exchange in the conversation",
      "minItems": 1,
      "items": {
        "$ref": "#/$defs/training_pair"
      }
    }
  },
  "$defs": {
    "training_pair": {
      "type": "object",
      "description": "A single training example",
      "required": [
        "id",
        "conversation_id",
        "turn_number",
        "conversation_metadata",
        "system_prompt",
        "conversation_history",
        "current_user_input",
        "emotional_context",
        "target_response",
        "training_metadata"
      ],
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique turn identifier"
        },
        "conversation_id": {
          "type": "string",
          "description": "Groups turns into conversations"
        },
        "turn_number": {
          "type": "integer",
          "minimum": 1
        },
        "conversation_metadata": {
          "$ref": "#/$defs/pair_conversation_metadata"
        },
        "system_prompt": {
          "type": "string",
          "minLength": 100
        },
        "conversation_history": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/history_turn"
          }
        },
        "current_user_input": {
          "type": "string",
          "minLength": 1
        },
        "emotional_context": {
          "$ref": "#/$defs/emotional_context"
        },
        "target_response": {
          "type": [
            "string",
            "null"
          ]
        },
        "training_metadata": {
          "$ref": "#/$defs/training_metadata"
        }
      }
    },
    "pair_conversation_metadata": {
      "type": "object",
      "description": "Per-pair metadata with scaffolding (v5 fields)",
      "required": [
        "client_persona",
        "persona_archetype",
        "client_background",
        "emotional_arc",
        "emotional_arc_key",
        "training_topic",
        "training_topic_key",
        "session_context",
        "conversation_phase",
        "expected_outcome"
      ],
      "properties": {
        "client_persona": {
          "type": "string"
        },
        "persona_archetype": {
          "type": "string",
          "enum": [
            "pragmatic_optimist",
            "anxious_planner",
            "overwhelmed_avoider"
          ]
        },
        "client_background": {
          "type": "string"
        },
        "emotional_arc": {
          "type": "string"
        },
        "emotional_arc_key": {
          "type": "string",
          "enum": [
            "confusion_to_clarity",
            "shame_to_acceptance",
            "fear_to_confidence",
            "overwhelm_to_empowerment"
          ]
        },
        "training_topic": {
          "type": "string"
        },
        "training_topic_key": {
          "type": "string"
        },
        "session_context": {
          "type": "string"
        },
        "conversation_phase": {
          "type": "string",
          "enum": [
            "initial_opportunity_exploration",
            "initial_shame_revelation",
            "initial_crisis_disclosure",
            "exploring_deeper_concern",
            "practical_implementation",
            "commitment_and_closure"
          ]
        },
        "expected_outcome": {
          "type": "string"
        }
      }
    },
    "history_turn": {
      "type": "object",
      "required": [
        "turn",
        "role",
        "content",
        "emotional_state"
      ],
      "properties": {
        "turn": {
          "type": "integer",
          "minimum": 1
        },
        "role": {
          "type": "string",
          "enum": [
            "user",
            "assistant"
          ]
        },
        "content": {
          "type": "string"
        },
        "emotional_state": {
          "type": "object",
          "required": [
            "primary",
            "intensity"
          ],
          "properties": {
            "primary": {
              "type": "string"
            },
            "secondary": {
              "type": "string"
            },
            "intensity": {
              "type": "number",
              "minimum": 0,
              "maximum": 1
            }
          }
        }
      }
    },
    "emotional_context": {
      "type": "object",
      "required": [
        "detected_emotions"
      ],
      "properties": {
        "detected_emotions": {
          "type": "object",
          "required": [
            "primary",
            "primary_confidence",
            "intensity",
            "valence"
          ],
          "properties": {
            "primary": {
              "type": "string"
            },
            "primary_confidence": {
              "type": "number",
              "minimum": 0,
              "maximum": 1
            },
            "secondary": {
              "type": "string"
            },
            "secondary_confidence": {
              "type": "number",
              "minimum": 0,
              "maximum": 1
            },
            "intensity": {
              "type": "number",
              "minimum": 0,
              "maximum": 1
            },
            "valence": {
              "type": "string",
              "enum": [
                "positive",
                "negative",
                "mixed"
              ]
            }
          }
        }
      }
    },
    "training_metadata": {
      "type": "object",
      "required": [
        "difficulty_level",
        "key_learning_objective",
        "demonstrates_skills",
        "conversation_turn",
        "emotional_progression_target",
        "quality_score",
        "quality_criteria",
        "human_reviewed",
        "reviewer_notes",
        "use_as_seed_example",
        "generate_variations_count"
      ],
      "properties": {
        "difficulty_level": {
          "type": "string"
        },
        "key_learning_objective": {
          "type": "string"
        },
        "demonstrates_skills": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "conversation_turn": {
          "type": "integer",
          "minimum": 1
        },
        "emotional_progression_target": {
          "type": "string"
        },
        "quality_score": {
          "type": "number",
          "minimum": 1,
          "maximum": 5
        },
        "quality_criteria": {
          "type": "object",
          "required": [
            "empathy_score",
            "clarity_score",
            "appropriateness_score",
            "brand_voice_alignment"
          ],
          "properties": {
            "empathy_score": {
              "type": "number",
              "minimum": 1,
              "maximum": 5
            },
            "clarity_score": {
              "type": "number",
              "minimum": 1,
              "maximum": 5
            },
            "appropriateness_score": {
              "type": "number",
              "minimum": 1,
              "maximum": 5
            },
            "brand_voice_alignment": {
              "type": "number",
              "minimum": 1,
              "maximum": 5
            }
          }
        },
        "human_reviewed": {
          "type": "boolean"
        },
        "reviewer_notes": {
          "type": [
            "string",
            "null"
          ]
        },
        "use_as_seed_example": {
          "type": "boolean"
        },
        "generate_variations_count": {
          "type": "integer",
          "minimum": 0
        }
      }
    }
  }
}